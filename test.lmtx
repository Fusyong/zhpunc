%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 演示：
%% 在processors类回调中干预断行；
%% tex.linebreak()的用法；
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \setuppapersize[A4,landscape]
\setuppapersize[A4]

% 中文配置
\mainlanguage[cn]
\language[cn]
\setscript[hanzi] % 汉字脚本（断行）
\setupalign[hanging,hz] %行末标点悬挂

% 汉字字体配置
\usetypescriptfile[mscore]
% \usebodyfont   [mschinese,20pt]
\usebodyfont   [mschinese-light,20pt]
% \setupbodyfont [mschinese-literate,20pt]
% \usebodyfont   [mschinese-literate,20pt]
% \definebodyfontenvironment[24pt]
% \definebodyfontenvironment[18pt]
% 定义字体
% \definefont[kaiti][name:kaiti*default at 24pt]

% 行距设置
\setupinterlinespace[line=1.6em]
% 缩进设置
% \setupindenting[yes, 2em, first]
\setuphead[indentnext=yes] %标题后段落缩进，默认是no


%%%%%%%%%%%%% 回调模块 %%%%%%%%%%%%%
\startluacode

---[[
-- 使用本地中文标点压缩模块
local zhpunc = require("./t-zhpunc.lua")
zhpunc.opt() --moduledata.zhpunc.opt()
--]]

--[[ 使用直排模块
local vertical_typeset = require("../vertical-typesetting/vertical_typeset.lua")
vertical_typeset.opt()--moduledata.vertical_typese.opt()
--]]

--[[
local jiazhu
--jiazhu = require("jiazhu_parshape.lua")
jiazhu = require("../jiazhu/jiazhu.lua")
jiazhu.register()
--]]

\stopluacode

% 标点宽度测试
\def\test[#1][#2]{%
    {\showglyphs\showboxes%
    \inframed[width=#1,align=flushleft,offset=0em]{\hbox{#2}}%
    }%
}

%%%%% 显式视觉调试信息 %%%%
% \showboxes
\showframe
% \showmakeup
% \tracingnodes1 %1,2
\replacemissingcharacters


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\starttext

\chapter{中文标点模块zhpunc测试}

\dorecurse{3}{%
《〈庄子〉寓言故事》：『朱泙(pēng)漫学屠龙于支离益，殚(dān)千金之家。三年技成，而无所用其巧！！』{\itxx （——《庄子·列御寇》， p125, f.f.）}【注释】（一）朱、支谐音；泙漫与离益意近，水满而漫溢也．（二）无所用其巧：真的无用吗？怎么可能？？！！当参考他处，以庄解庄。……
}

\section{标点字模的占位}


\test[2.5em][。？！．]

\test[2.5em][，、；：]

\test[6.5em][”’）］〕】》〉」』〗｝]

\test[6.5em][“‘（［〔【《〈「『〖｛]

\test[2em][……]

\test[2em][——]

\test[2em][—～]

\test[2.5em][-·/／]

\section{标点组与加空}

\subsection{全角配置}

        \test[6em][囗囗《〈“囗囗]

        \test[6em][囗囗”〉》囗囗]

        \test[6em][囗囗！〉》囗囗]

        \test[6em][囗囗〉》！囗囗]

        \test[5.5em][囗囗？！囗囗]

        \test[6em][囗囗？！！囗囗]

        \test[4.5em][囗囗·囗囗]

        \test[4.5em][囗囗/囗囗]

        \test[5em][囗囗～囗囗]

        \test[6em][囗囗——囗囗]

        \test[7.5em][囗囗”〉》《〈“囗囗]

        \test[8em][囗囗”〉》！《〈“囗囗]

        \test[5.5em][囗囗”·“囗囗]

        \test[5em][囗囗”·囗囗]
        
        \test[5em][囗囗·“囗囗]

\subsection{开明配置}

        \test[5.5em][囗囗《〈“囗囗]

        \test[5.5em][囗囗”〉》囗囗]

        \test[5.5em][囗囗！〉》囗囗]

        \test[6em][囗囗〉》！囗囗]

        \test[5.5em][囗囗？！囗囗]

        \test[6em][囗囗？！！囗囗]

        \test[4.5em][囗囗·囗囗]

        \test[4.5em][囗囗/囗囗]

        \test[5em][囗囗～囗囗]

        \test[6em][囗囗——囗囗]

        \test[7em][囗囗”〉》《〈“囗囗]

        \test[8em][囗囗”〉》！《〈“囗囗]

        \test[5.5em][囗囗”·“囗囗]

        \test[5em][囗囗”·囗囗]

        \test[5em][囗囗·“囗囗]


\stoptext