%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 演示：
%% 在processors类回调中干预断行；
%% tex.linebreak()的用法；
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \setuppapersize[A4,landscape]
\setuppapersize[A4]

% 中文配置
\mainlanguage[cn]
\language[cn]
\setscript[hanzi] % 汉字脚本（断行）
\setupalign[hanging,hz] %行末标点悬挂

% 汉字字体配置
\usetypescriptfile[mscore]
\usebodyfont   [mschinese,20pt]
% \usebodyfont   [mschinese-light,20pt]
% \setupbodyfont [mschinese-literate,20pt]
% \usebodyfont   [mschinese-literate,20pt]
% \definebodyfontenvironment[24pt]
% \definebodyfontenvironment[18pt]
% 定义字体
% \definefont[kaiti][name:kaiti*default at 24pt]

% 行距设置
\setupinterlinespace[line=1.6em]
% 缩进设置
\setupindenting[yes, 2em, first]
\setuphead[indentnext=yes] %标题后段落缩进，默认是no


% 标点宽度测试
\def\test[#1][#2]{%
    {\showglyphs\showboxes%
    \inframed[width=#1,align=flushleft,offset=0em]{\hbox{#2}}%
    }%
}

%%%%% 显式视觉调试信息 %%%%
\showboxes
\showframe
\showglyphs
% \showbodyfont
% \showmakeup
% \tracingnodes1 %1,2
\replacemissingcharacters


%%%%%%%%%%%%% 使用模块(保持顺序) %%%%%%%%%%%%%
% 竖排
\usemodule[vtypeset]


% 标点压缩与支持
\usemodule[zhpunc][pattern=kaiming, spacequad=0.5, hangjian=false]
% 
% 四种标点压缩方案：全角、开明、半角、原样：
%   pattern: quanjiao(default), kaiming, banjiao, yuanyang
% 行间标点（转换`、，。．：！；？`到行间，pattern建议用banjiao）：
%   hangjian: false(default), true
% 加空宽度（角）：
%   spacequad: 0.5(default)
% 
% 行间书名号和专名号（\bar实例）：
%   \zhuanmh{专名}
%   \shumh{书名}


% 夹注
\usemodule[jiazhu][fontname=tf, fontsize=10.5pt, interlinespace=0.2em]
% default: fontname=tf, fontsize=10.5pt, interlinespace=0.08em(行间标点时约0.2em)
% fontname和fontsize与\switchtobodyfont的对应参数一致
% 夹注命令：
%   \jiazh{夹注}

% 标点宽度测试
\def\test[#1][#2]{%
    {\showglyphs\showboxes%
        \inframed[width=#1,align=flushleft,offset=0em]{\hbox{#2}}%
    }%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\starttext

囗·囗

囗-囗

囗/囗

囗，囗



% 囗囗。囗囗



% \test[4.5em][囗囗。《囗]


% 我\jiazh{本，謂身也。所厚，謂家也。此兩節結上文兩節之意。}

% 我：“你？！”\jiazh{本，謂身也。所厚，謂家也。此兩節結上文兩節之意。}

% <node :   3213 <=   3184 =>   3026 : hlist box> 。      0       0       0       -503424 nil     nil     nil
    % <node :    nil <=   3142 =>   1714 : glue userskip>     0       65536   65536   2       2
    % <node :   3142 <=   1714 =>   3390 : kern userkern>     0       nil
    % <node :   1714 <=   3390 =>   1708 : glyph unset>       。
    % <node :   3390 <=   1708 =>    nil : kern userkern>     -655500 nil


% <node :   3364 <=   3490 =>   3505 : hlist box> b       0       947052  18648   -755136 nil     nil     nil
    % <node :    nil <=   3468 =>   3475 : glue userskip>     0       65536   65536   2       2
    % <node :   3468 <=   3475 =>    nil : glyph unset>       b

% 标点压缩在前夹注在后缺失凸排（？？夹注造成的parinitrightskip）
% ...
% <node :   4827 <=   3650 =>   4830 : glyph unset>       ，
% <node :   3650 <=   4830 =>   4994 : kern userkern>     0       nil
% <node :   4830 <=   4994 =>   5426 : glue parinitrightskip>     0       0       0       0       0
% <node :   4994 <=   5426 =>   5447 : glue rightskip>    0       0       0       0       0
% <node :   5426 <=   5447 =>    nil : glue righthangskip>        0       0       0       0       0

% 标点压缩在后夹注在前正确凸排
% ...
% <node :   4917 <=   4040 =>   5467 : glyph unset>       ，
% <node :   4040 <=   5467 =>   4920 : kern rightmarginkern>      -852150 nil
% <node :   5467 <=   4920 =>   4385 : kern userkern>     0       nil
% <node :   4920 <=   4385 =>   5484 : glue rightskip>    0       0       0       0       0
% <node :   4385 <=   5484 =>    nil : glue righthangskip>        0       0       0       0       0

\stoptext